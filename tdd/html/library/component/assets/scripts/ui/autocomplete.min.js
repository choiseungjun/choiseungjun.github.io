!function(e,t,o){"use strict";e(window),e(document);var i=t.ui("Autocomplete",{bindjQuery:"autocomplete",defaults:{minLen:1},selectors:{keywordList:"",keywordClass:""},initialize:function(e,o){var i=this;if(!1!==i.supr(e,o)){i.minLen=i.options.minLen,i.keywordListArr=[];var r=i.options.list||i.$el.data("list");if(t.is(r,"string"))try{i.keywordListArr=new Function("return "+r)()}catch(e){i.keywordListArr=[]}else t.is(r,"array")&&(i.keywordListArr=r);var n=i.options.url||i.$el.data("url");n&&(i.ajaxUrl=n),i._build(),i._bindEvents()}},_build:function(){var t=this,o=t.$el.position().top+t.$el.outerHeight(),i=t.$el.position().left,r=t.$el.outerWidth(),n="";if(n=t.options.keywordClass?"style='position:absolute; min-width:"+r+"px; left:"+i+"px; top:"+o+"px;' class='"+t.options.keywordClass+"'":"style='position:absolute; background-color:#ffffff; min-width:"+r+"px; left:"+i+"px; top:"+o+"px;",t.$keywordList.length)t.$keywordList.attr("style",n);else{var s="ui_keyword_list_"+t.cid.toLowerCase();t.$el.after("<div id='"+s+"'"+n+"'><ul></ul></div>"),t.$keywordList=e("#"+s)}t.$keywordList.css("display","none")},_bindEvents:function(){var e=this,o=[t.keyCode.UP,t.keyCode.LEFT,t.keyCode.DOWN,t.keyCode.RIGHT,t.keyCode.END,t.keyCode.HOME,t.keyCode.ENTER,t.keyCode.ESCAPE];t.detect.isGecko&&e._forceKeyup(),e.on("focusout",function(t){e.closeTimer=setTimeout(function(){e._close()},100)}).on("keyup paste cut focusin",function(i){"keyup"==i.type&&t.array.include(o,i.keyCode)||e.oldKeyword!=this.value&&(e.oldKeyword=this.value,clearTimeout(e.closeTimer),e.ajaxUrl?e._loadKeywords(this.value):e._renderKeywords(this.value,e.keywordListArr))}).on("keydown",function(o){switch(o.keyCode){case t.keyCode.UP:o.preventDefault(),e._selectItem("up");break;case t.keyCode.DOWN:o.preventDefault(),e._selectItem("down");break;case t.keyCode.ESC:o.preventDefault(),e._close();break;case t.keyCode.ENTER:o.preventDefault(),e._close(),e.$el.triggerHandler("autocompleteenter")}}),e.$keywordList.on("focusin focusout",function(t){"focusin"===t.type?clearTimeout(e.closeTimer):e.closeTimer=setTimeout(function(){e._close()},100)})},_forceKeyup:function(){var e,t=this,o=window,i=document,r=i.createEvent?function(e){var r;o.KeyEvent?(r=i.createEvent("KeyEvents")).initKeyEvent("keyup",!0,!0,o,!1,!1,!1,!1,65,0):((r=i.createEvent("UIEvents")).initUIEvent("keyup",!0,!0,o,1),r.keyCode=65),t.$el[0].dispatchEvent(r)}:function(e){var o=i.createEventObject();o.keyCode=65,t.$el[0].fireEvent("onkeyup",o)},n=null;t.on("focusin",function(){if(!n){var o=this;t.intervalTimer=n=setInterval(function(){e=o.value,t.oldKeyword!==e&&(t.oldKeyword=e,r())},60)}}).on("focuout",function(){n&&(clearInterval(n),n=null)})},_selectItem:function(e){var t,o,i,r,n=this;r=(o=n.$keywordList.find("li")).size(),t=o.index(o.filter(".active")),"up"===e?(t-=1)<0&&(t=r-1):(t+=1)>=r&&(t=0),i=o.eq(t),o.filter(".active").removeClass("active"),i.addClass("active"),n.$el.val(i.data("keyword"));var s=i.data("id"),l=n.keywordListArr[s];n.$el.triggerHandler("autocompleteselect",l)},_close:function(){var e=this;e.oldKeyword="",e.$keywordList.find("li").off("mousedown mouseenter"),e._toggle(!1)},_open:function(){this._toggle(!0)},_loadKeywords:function(o){var i=this;i.xhr&&4!=i.xhr.readyState&&(i.xhr.abort(),i.xhr=null);{if(!(""==e.trim(o)||o.length<i.minLen))return i.xhr=e.ajax({url:i.ajaxUrl,dataType:"json",cache:!1,data:{query:o}}).done(function(e){0!=e.responsestatus||t.isEmpty(e.result)?i._close():(i.keywordListArr=e.result,i._renderKeywords(o,i.keywordListArr))}).fail(function(){i._close()}),i.xhr;i._close()}},_renderKeywords:function(o,i){var r=this,n="";""==e.trim(o)||o.length<r.minLen?r._close():(r._open(),t.each(i,function(e,i){var r=t.type(e,"object")?t.string.escapeHTML(e.keyword):t.string.escapeHTML(e);-1!=r.indexOf(o)&&(n+='<li data-id="'+i+'" data-keyword="'+r+'"><a href="#">'+r.replace(o,"<b>"+o+"</b>")+"</a></li>")}),n?(r.$keywordList.find("ul").html(n),r.$keywordList.find("li").off("mousedown").on("mousedown",function(t){t.preventDefault(),r.$el.val(e(this).data("keyword"));var o=e(this).data("id"),i=r.keywordListArr[o];r.$el.triggerHandler("autocompleteselect",i),r._close()}),r.$keywordList.find("li").off("mouseenter").on("mouseenter",function(e){e.preventDefault(),r.$keywordList.find("li").removeClass("active")})):(r.$keywordList.find("li").off("mousedown mouseenter"),r.$keywordList.find("ul").empty()))},_toggle:function(e){var t=this;0===arguments.length&&(e=!t.$keywordList.is(".visible")),t.$keywordList.toggle(e).toggleClass("visible",e)},destroy:function(){var e=this;clearInterval(e.intervalTimer),e.$keywordList.off(),e.supr()}});"function"==typeof define&&define.amd&&define([],function(){return i})}(jQuery,window[LIB_NAME]);