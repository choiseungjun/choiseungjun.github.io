!function(t,n){"use strict";var a={get:function(e){if(n.is(e.selectionStart,"number"))return{begin:e.selectionStart,end:e.selectionEnd};var t=document.selection.createRange();if(t&&t.parentElement()===e){var a=e.createTextRange(),o=e.createTextRange(),r=e.value.length;return a.moveToBookmark(t.getBookmark()),o.collapse(!1),a.compareEndPoints("StartToEnd",o)>-1?{begin:r,end:r}:{begin:-a.moveStart("character",-r),end:-a.moveEnd("character",-r)}}return{begin:0,end:0}},set:function(e,t){if(n.is(t,"object")||(t={begin:t,end:t}),e.setSelectionRange)e.setSelectionRange(t.begin,t.end);else if(e.createTextRange){var a=e.createTextRange();a.collapse(!0),a.moveEnd("character",t.end),a.moveStart("character",t.begin),a.select()}}},o={numRegex:/[^0-9]/g,engRegex:/[^a-zA-Z\s]/g,alphaRegex:/[^a-zA-Z]/g,alnumRegex:/[^a-zA-Z0-9]/g,engnumRegex:/[^a-zA-Z0-9\s]/g,isPressedMetaKey:function(e){return e.ctrlKey||e.shiftKey||e.altKey},numKey:function(e){e.keyCode;return e.keyCode>=48&&e.keyCode<=57||e.keyCode>=96&&e.keyCode<=105},engKey:function(e){var t=e.keyCode;return t>=65&&t<=90||t>=97&&t<=122||32===t},alphaKey:function(e){var t=e.keyCode;return t>=65&&t<=90||t>=97&&t<=122},alnumKey:function(e){var t=e.keyCode;return t>=65&&t<=90||t>=97&&t<=122||t>=48&&t<=57},engnumKey:function(e){var t=e.keyCode;return t>=65&&t<=90||t>=97&&t<=122||t>=48&&t<=57||32===t},isInvalidKey:function(e,t,a){return!o.isPressedMetaKey(e)&&!o[t+"Key"](e)&&!n.array.include(a,e.keyCode)},cleanChars:function(e,t,n){var r=a.get(t);t.value=t.value.replace(o[e+"Regex"],""),n&&a.set(t,Math.min(r.begin,t.value.length))}},r="placeholder"in document.createElement("input"),i=n.ui("Formatter",{$statics:{byPassKeys:[8,9,16,17,18,35,36,37,38,39,40,46,91,116],translation:{0:{pattern:/\d/},9:{pattern:/\d/,optional:!0},"#":{pattern:/\d/,recursive:!0},A:{pattern:/[a-zA-Z0-9]/},S:{pattern:/[a-zA-Z]/}},masks:{comma:{format:"000,000,000,000,000,000,000,000,000",reverse:!0},tel:{format:function(e,t,n,a){return e.replace(/\D/g,"").length<8?"000-0000":"0000-0000"}},mobile:{format:function(e,t,n,a){return e.replace(/\D/g,"").length<8?"000-0000":"0000-0000"}},num:{format:"0000000000000000000"},card:{format:"0000-0000-0000-0000"},amexcard:{format:"0000-000000-00000"},driverno:{format:"00-000000-00"},bizno:{format:"000-00-00000"},corpno:{format:"000000-0000000"},date:{format:"0000.00.00"},eng:{format:"S"}}},bindjQuery:"formatter",defaults:{format:"comma",watch:!0,watchInterval:300},initialize:function(e,t){var o=this;if(!1===o.supr(e,t))return!1;if(o.$el.attr("autocomplete","off"),!0!==o._isSimpleFormat()){o._bindEvents(),o.oldValue=o.$el.val(),o.byPassKeys=i.byPassKeys,o.translation=n.extend({},i.translation,o.options.translation),o.invalid=[],r||(o.notSupportPlaceholder=!0,o.txtPlaceholder=o.$el.attr("placeholder")),o._reloadMask();var l=a.get(o.el).begin;o.update(),o.$el.is(":focus")&&a.set(o.el,l+o._getMCharsBeforeCount(l,!0)),o.regexMask=o._getRegexMask(),o.options.watch&&o._watchStart()}else o.clean=function(){return o.$el.val()===o.txtPlaceholder?"":o.$el.val()}},update:function(){var e=this;e.$el.val()&&e.$el.val(this._getMasked())},_reloadMask:function(){var e,t=this;(e=i.masks[t.options.format])?(n.is(e.format,"function")?t.mask=e.format.call(t,t.$el.val()):t.mask=e.format,t.options.reverse=!!e.reverse):t.mask=n.is(t.options.format,"function")?t.options.format.call(t):t.options.format},_isSimpleFormat:function(){var e,t=this,a=t.options.format;if("eng"===a||"alnum"===a||"num"===a)return t.$el.on("keydown focusin keyup focusout paste",function(t){var n=this;switch(t.type){case"keydown":o.isInvalidKey(t,a,[].concat(i.byPassKeys,16))&&t.preventDefault();case"focusin":e=this.value;break;case"keyup":case"focusout":case"paste":setTimeout(function(){e!=n.value&&(o.cleanChars(a,n,"focusout"!==t.type),e=n.value)})}}),!0;n.array.include(["card","amexcard","tel","mobile","bizno","corpno","comma","date"],a)&&(window.IS_DEBUG&&n.browser.isMobile&&t.$el.attr("type","tel"),t.$el.on("keydown focusin",function(t){"keydown"===t.type&&o.isInvalidKey(t,"num",i.byPassKeys)&&t.preventDefault(),e=this.value}))},_bindEvents:function(){var n=this;n.$el.on("keyup",function(e){n._reloadMask(),n._process(e)}).on("paste drop",function(){setTimeout(function(){n.$el.keydown().keyup()})}).on("change",function(){n.$el.data("changed",!0)}).on("blur",function(e){n.oldValue==n.$el.val()||n.$el.data("changed")||n.$el.triggerHandler("change"),n.$el.data("change",!1),n._watchStart()}).on("keydown blur",function(){n.oldValue=n.$el.val()}).on("focusin",function(){!0===n.options.selectOnFocus&&t(e.target).select(),n._watchStop()}).on("focusout",function(){n.options.clearIfNotMatch&&!n.regexMask.test(n.$el.val())&&n.$el.val("")}),"comma"===n.options.format&&t(n.el.form).on("submit",function(e){n.remove(),n.oldValue=""})},_watchStart:function(){var e=this;if(e._watchStop(),e.options.watch&&!e.$el.prop("readonly")&&!e.$el.prop("disabled")){var n=0,a=e.options.watchInterval;e.watchTimer=setInterval(function(){if(n>4e4){if(n=0,!t.contains(document,e.$el[0]))return clearInterval(e.watchTimer),void(e.watchTimer=null)}else n+=a;if(!(e.$el[0].disabled||0<=e.$el[0].className.indexOf("disabled"))){var o=e.$el.val();o&&e.oldValue!=o&&e.update()}},a)}},_watchStop:function(){var e=this;clearInterval(e.watchTimer),e.watchTimer=null},_getRegexMask:function(){for(var e,t,n,a,o,r,i=this,l=[],s=0,c=i.mask.length;s<c;s++)r=i.mask.charAt(s),(e=i.translation[r])?(t=e.pattern.toString().replace(/.{1}$|^.{1}/g,""),n=e.optional,e.recursive?(l.push(r),a={digit:r,pattern:t}):l.push(n?t+"?":t)):l.push(r.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"));return o=l.join(""),a&&(o=o.replace(new RegExp("("+a.digit+"(.*"+a.digit+")?)"),"($1)?").replace(new RegExp(a.digit,"g"),a.pattern)),new RegExp(o)},_getMCharsBeforeCount:function(e,t){for(var n=this,a=n.mask,o=0,r=0,i=a.length;r<i&&r<e;r++)n.translation[a.charAt(r)]||(e=t?e+1:e,o++);return o},_caretPos:function(e,t,n,a){var o=this,r=o.mask;return o.translation[r.charAt(Math.min(e-1,r.length-1))]?Math.min(e+n-t-a,n):o._caretPos(e+1,t,n,a)},_process:function(e){var n=this,o=e.keyCode;if(!(17===o||65===o&&e.ctrlKey)&&(n.invalid=[],-1===t.inArray(o,n.byPassKeys)||46===o||8===o)){var r=a.get(n.el).begin,i=n.$el.val().length,l=r<i,s=n._getMasked(),c=s.length,u=n._getMCharsBeforeCount(c-1)-n._getMCharsBeforeCount(i-1);return n.$el.val(s),!l||65===o&&e.ctrlKey||(8!==o&&46!==o&&(r=n._caretPos(r,i,c,u)),n.$el.is(":focus")&&a.set(n.el,r)),n._callbacks(e)}},_getMasked:function(e){var t,n,a=this,o=a.mask,r=[],i=a.$el.val(),l=0,s=o.length,c=0,u=i.length,f=1,d="push",p=-1;for(a.options.reverse?(d="unshift",f=-1,t=0,l=s-1,c=u-1,n=function(){return l>-1&&c>-1}):(t=s-1,n=function(){return l<s&&c<u});n();){var h=o.charAt(l),m=i.charAt(c),g=a.translation[h];g?(m.match(g.pattern)?(r[d](m),g.recursive&&(-1===p?p=l:l===t&&(l=p-f),t===p&&(l-=f)),l+=f):g.optional?(l+=f,c-=f):g.fallback?(r[d](g.fallback),l+=f,c-=f):a.invalid.push({p:c,v:m,e:g.pattern}),c+=f):(e||r[d](h),m===h&&(c+=f),l+=f)}var v=o.charAt(t);return s!==u+1||a.translation[v]||r.push(v),r.join("")},_callbacks:function(e){var t=this,n=t.mask,a=t.$el.val(),o=a!==t.oldValue,r=[a,e,t.el,t.options],i=function(e,n,a){"function"==typeof t.options[e]&&n&&t.options[e].apply(this,a)};i("onChange",!0===o,r),i("onKeyPress",!0===o,r),i("onComplete",a.length===n.length,r),i("onInvalid",t.invalid.length>0,[a,e,t.el,t.invalid,t.options])},remove:function(){var e=this,t=a.get(e.el).begin;e._watchStop(),e.$el.off(),e.$el.val(e.clean()),e.$el.is(":focus")&&a.set(e.el,t-e._getMCharsBeforeCount(t))},clean:function(){return this._getMasked(!0)}});"function"==typeof define&&define.amd&&define([],function(){return i})}(jQuery,window[LIB_NAME]);